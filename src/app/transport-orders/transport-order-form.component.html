<!-- src/app/transport-orders/transport-order-form/transport-order-form.component.html -->
<div class="transport-order-container">
  <h1>Zamówienie transportu roweru</h1>
  
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-message">
    <div class="loading-spinner"></div>
    <p>Ładowanie danych...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-message">
    {{ error }}
  </div>

  <!-- Steps Progress -->
  <div class="steps-container">
    <div class="step completed">
      <div class="step-number">1</div>
      <div class="step-label">Dane rowerów</div>
    </div>
    <div class="step-connector"></div>
    <div class="step active">
      <div class="step-number">2</div>
      <div class="step-label">Dane kontaktowe</div>
    </div>
    <div class="step-connector"></div>
    <div class="step">
      <div class="step-number">3</div>
      <div class="step-label">Szczegóły transportu</div>
    </div>
    <div class="step-connector"></div>
    <div class="step">
      <div class="step-number">4</div>
      <div class="step-label">Podsumowanie</div>
    </div>
  </div>

  <!-- Main Form -->
  <div *ngIf="!loading && !error" class="step-content">
    <!-- Service Info Card -->
    <div class="service-info-card" *ngIf="selectedServiceInfo.name">
      <h3>Serwis docelowy</h3>
      <div class="service-details">
        <div class="service-name">{{ selectedServiceInfo.name }}</div>
        <div class="service-address">📍 {{ selectedServiceInfo.address }}</div>
      </div>
    </div>

    <form [formGroup]="transportForm" (ngSubmit)="onSubmit()">
      <!-- KROK 1: Bicycle Information Section - PIERWSZA SEKCJA -->
      <div class="form-section">
        <h2>Dane rowerów do transportu</h2>
        <p class="section-description">
          Dodaj informacje o rowerach, które mają zostać przewiezione do serwisu.
        </p>

        <div formArrayName="bicycles">
          <div 
            *ngFor="let bicycleControl of bicyclesArray.controls; let i = index" 
            [formGroupName]="i" 
            class="bicycle-form-card"
          >
            <div class="bicycle-card-header">
              <h4>Rower {{ i + 1 }}</h4>
              <button 
                type="button" 
                class="remove-bicycle-btn" 
                (click)="removeBicycleFromForm(i)"
                *ngIf="bicyclesArray.length > 1"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label [for]="'brand-' + i">Marka*</label>
                <input 
                  type="text" 
                  [id]="'brand-' + i"
                  formControlName="brand"
                  [class.is-invalid]="bicycleControl.get('brand')?.invalid && bicycleControl.get('brand')?.touched"
                  placeholder="np. Giant, Trek, Specialized"
                >
                <div *ngIf="bicycleControl.get('brand')?.invalid && bicycleControl.get('brand')?.touched" class="error-message">
                  Marka roweru jest wymagana
                </div>
              </div>

              <div class="form-group">
                <label [for]="'model-' + i">Model*</label>
                <input 
                  type="text" 
                  [id]="'model-' + i"
                  formControlName="model"
                  [class.is-invalid]="bicycleControl.get('model')?.invalid && bicycleControl.get('model')?.touched"
                  placeholder="np. Talon, Marlin, Rockhopper"
                >
                <div *ngIf="bicycleControl.get('model')?.invalid && bicycleControl.get('model')?.touched" class="error-message">
                  Model roweru jest wymagany
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label [for]="'type-' + i">Typ roweru*</label>
                <select 
                  [id]="'type-' + i"
                  formControlName="type"
                  [class.is-invalid]="bicycleControl.get('type')?.invalid && bicycleControl.get('type')?.touched"
                >
                  <option value="">-- Wybierz typ --</option>
                  <option *ngFor="let type of getBicycleTypes()" [value]="type">{{ type }}</option>
                </select>
                <div *ngIf="bicycleControl.get('type')?.invalid && bicycleControl.get('type')?.touched" class="error-message">
                  Typ roweru jest wymagany
                </div>
              </div>

              <div class="form-group">
                <label [for]="'frameMaterial-' + i">Materiał ramy</label>
                <select 
                  [id]="'frameMaterial-' + i"
                  formControlName="frameMaterial"
                >
                  <option value="">-- Wybierz materiał --</option>
                  <option *ngFor="let material of getFrameMaterials()" [value]="material">{{ material }}</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label [for]="'description-' + i">Dodatkowe informacje o rowerze</label>
                <textarea 
                  [id]="'description-' + i"
                  formControlName="description"
                  rows="3"
                  placeholder="Dodatkowe informacje o rowerze, usterki, specjalne wymagania..."
                ></textarea>
              </div>
            </div>
          </div>
        </div>

        <button type="button" class="add-bicycle-btn" (click)="addBicycleToForm()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Dodaj kolejny rower
        </button>
      </div>

      <!-- KROK 2: Client Information Section -->
      <div class="form-section">
        <h2>Dane kontaktowe</h2>
        <p class="section-description">
          Podaj swoje dane kontaktowe potrzebne do realizacji transportu.
        </p>

        <div class="form-row">
          <div class="form-group">
            <label for="clientEmail">Email*</label>
            <input 
              type="email" 
              id="clientEmail" 
              formControlName="clientEmail"
              [class.is-invalid]="isFieldInvalid('clientEmail')"
              placeholder="jan.kowalski@example.com"
            >
            <div *ngIf="isFieldInvalid('clientEmail')" class="error-message">
              Wprowadź poprawny adres email
            </div>
          </div>
          
          <div class="form-group">
            <label for="clientPhone">Telefon*</label>
            <input 
              type="tel" 
              id="clientPhone" 
              formControlName="clientPhone"
              [class.is-invalid]="isFieldInvalid('clientPhone')"
              placeholder="123456789"
              maxlength="9"
            >
            <div *ngIf="isFieldInvalid('clientPhone')" class="error-message">
              Wprowadź poprawny numer telefonu (9 cyfr)
            </div>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="clientName">Imię i nazwisko*</label>
            <input 
              type="text" 
              id="clientName" 
              formControlName="clientName"
              [class.is-invalid]="isFieldInvalid('clientName')"
              placeholder="Jan Kowalski"
            >
            <div *ngIf="isFieldInvalid('clientName')" class="error-message">
              Imię i nazwisko jest wymagane
            </div>
          </div>
        </div>
      </div>

      <!-- KROK 3: Pickup Details Section -->
      <div class="form-section">
        <h2>Szczegóły odbioru</h2>

        <div class="form-group">
          <label for="pickupDate">Data odbioru*</label>
          <div class="date-info">
            Odbiór roweru dostępny od niedzieli do czwartku w godzinach 18:00-22:00.
          </div>
          <input 
            type="date" 
            id="pickupDate" 
            formControlName="pickupDate"
            [class.is-invalid]="isFieldInvalid('pickupDate')"
            [min]="minDate"
            [max]="maxDate"
          >
          <div *ngIf="isFieldInvalid('pickupDate')" class="error-message">
            Wybierz datę odbioru
          </div>
        </div>
        
        <div class="form-group">
          <label for="pickupAddress">Adres odbioru*</label>
          <input 
            type="text" 
            id="pickupAddress" 
            formControlName="pickupAddress"
            [class.is-invalid]="isFieldInvalid('pickupAddress')"
            placeholder="ul. Przykładowa 123/45"
          >
          <div *ngIf="isFieldInvalid('pickupAddress')" class="error-message">
            Adres jest wymagany
          </div>
        </div>
        
        <div class="form-group">
          <label for="additionalNotes">Dodatkowe informacje</label>
          <textarea 
            id="additionalNotes" 
            formControlName="additionalNotes"
            rows="3"
            placeholder="Informacje o preferowanych godzinach odbioru, dodatkowe wskazówki dla kuriera, itp."
          ></textarea>
        </div>
      </div>

      <!-- KROK 4: Order Summary -->
      <div class="summary-container" *ngIf="getSelectedBicyclesCount() > 0">
        <h2>Podsumowanie zamówienia</h2>
        
        <!-- Podsumowanie rowerów -->
        <div class="summary-section">
          <h3>Rowery do transportu</h3>
          <div class="summary-bikes">
            <div *ngFor="let bicycleData of getBicyclesData(); let i = index" class="summary-bike">
              <span class="bike-index">{{ i + 1 }}.</span>
              <span class="bike-name">{{ bicycleData.brand }} {{ bicycleData.model || '' }}</span>
            </div>
          </div>
        </div>
        
        <!-- Podsumowanie kontaktu -->
        <div class="summary-section">
          <h3>Dane kontaktowe</h3>
          <div class="summary-contact">
            <div class="contact-row">
              <span class="contact-label">Email:</span>
              <span class="contact-value">{{ transportForm.get('clientEmail')?.value }}</span>
            </div>
            <div class="contact-row">
              <span class="contact-label">Telefon:</span>
              <span class="contact-value">{{ transportForm.get('clientPhone')?.value }}</span>
            </div>
            <div class="contact-row">
              <span class="contact-label">Imię i nazwisko:</span>
              <span class="contact-value">{{ transportForm.get('clientName')?.value }}</span>
            </div>
          </div>
        </div>
        
        <!-- Podsumowanie transportu -->
        <div class="summary-section">
          <h3>Szczegóły transportu</h3>
          <div class="summary-contact">
            <div class="contact-row">
              <span class="contact-label">Data odbioru:</span>
              <span class="contact-value">{{ transportForm.get('pickupDate')?.value | date:'dd.MM.yyyy' }}</span>
            </div>
            <div class="contact-row">
              <span class="contact-label">Adres odbioru:</span>
              <span class="contact-value">{{ transportForm.get('pickupAddress')?.value }}</span>
            </div>
            <div class="contact-row">
              <span class="contact-label">Serwis docelowy:</span>
              <span class="contact-value">{{ selectedServiceInfo.name }}</span>
            </div>
            <div *ngIf="transportForm.get('additionalNotes')?.value" class="contact-row">
              <span class="contact-label">Dodatkowe informacje:</span>
              <span class="contact-value">{{ transportForm.get('additionalNotes')?.value }}</span>
            </div>
          </div>
        </div>
        
        <!-- Suma zamówienia -->
        <div class="summary-total">
          <div class="total-label">Całkowity koszt transportu:</div>
          <div class="total-price">{{ getEstimatedTransportCost() }} zł</div>
          <div class="total-details">({{ getSelectedBicyclesCount() }} {{ getSelectedBicyclesCount() === 1 ? 'rower' : getSelectedBicyclesCount() > 1 && getSelectedBicyclesCount() < 5 ? 'rowery' : 'rowerów' }})</div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="step-actions">
        <button type="button" class="back-btn" (click)="goBack()">Wróć</button>
        <button 
          type="submit" 
          class="submit-btn" 
          [disabled]="transportForm.invalid || submitting || getSelectedBicyclesCount() === 0"
        >
          {{ submitting ? 'Przetwarzanie...' : 'Zamów transport' }}
        </button>
      </div>
    </form>
  </div>
</div>
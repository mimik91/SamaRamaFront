<div class="opening-hours-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Ładowanie godzin otwarcia...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading" class="content">
    <!-- Header -->
    <div class="header">
      <div class="title-section">
        <svg class="header-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"/>
        </svg>
        <h2>Godziny otwarcia</h2>
      </div>
      
      <div class="action-buttons" *ngIf="!isEditMode && hasExistingHours">
        <button class="btn btn-primary" (click)="enterEditMode()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
          </svg>
          Edytuj
        </button>
      </div>
    </div>

    <!-- Form -->
    <form [formGroup]="openingHoursForm" (ngSubmit)="saveOpeningHours()">
      
      <!-- Days Schedule -->
      <div class="card schedule-card">
        <div class="card-header">
          <h3 class="card-title">Harmonogram tygodniowy</h3>
          <p class="card-subtitle">
            {{ isEditMode ? 'Ustaw godziny otwarcia dla każdego dnia' : 'Twoje godziny otwarcia' }}
          </p>
        </div>
        
        <div class="card-content" formGroupName="days">
          <div *ngFor="let day of daysOfWeek; let i = index" class="day-row" [formGroupName]="day.key">
            
            <!-- Display Mode -->
            <div *ngIf="!isEditMode" class="day-display">
              <div class="day-label">
                <strong>{{ day.label }}</strong>
              </div>
              <div class="day-hours">
                <ng-container *ngIf="getDisplayInterval(day.key); else closedDay">
                  <div class="chip time-chip open">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"/>
                    </svg>
                    {{ getDisplayInterval(day.key)!.openTime }} - {{ getDisplayInterval(day.key)!.closeTime }}
                  </div>
                </ng-container>
                <ng-template #closedDay>
                  <div class="chip time-chip closed">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"/>
                    </svg>
                    Zamknięte
                  </div>
                </ng-template>
              </div>
            </div>

            <!-- Edit Mode -->
            <div *ngIf="isEditMode" class="day-edit">
              <label class="checkbox-container day-checkbox">
                <input type="checkbox" formControlName="enabled">
                <span class="checkmark"></span>
                <strong>{{ day.label }}</strong>
              </label>

              <div class="time-inputs" *ngIf="isDayEnabled(day.key)">
                <div class="form-field time-field">
                  <label>Od</label>
                  <input type="time" formControlName="openTime" class="time-input">
                </div>

                <span class="time-separator">—</span>

                <div class="form-field time-field">
                  <label>Do</label>
                  <input type="time" formControlName="closeTime" class="time-input">
                </div>

                <button 
                  type="button" 
                  class="icon-button copy-button"
                  title="Skopiuj do wszystkich dni"
                  (click)="copyToAllDays(day.key)">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                  </svg>
                </button>
              </div>

              <div class="closed-label" *ngIf="!isDayEnabled(day.key)">
                <div class="chip closed-chip">Zamknięte</div>
              </div>
            </div>

            <hr *ngIf="i < daysOfWeek.length - 1" class="divider">
          </div>
        </div>
      </div>

      <!-- Additional Information -->
      <div class="card info-card">
        <div class="card-header">
          <h3 class="card-title">Dodatkowe informacje</h3>
        </div>
        
        <div class="card-content">
          <!-- Display Mode -->
          <div *ngIf="!isEditMode" class="info-display">
            <div class="info-section" *ngIf="displayedData?.openingHoursInfo">
              <strong>Informacje:</strong>
              <p>{{ displayedData!.openingHoursInfo }}</p>
            </div>

            <div class="info-section" *ngIf="displayedData?.openingHoursNote">
              <strong>Uwagi:</strong>
              <p>{{ displayedData!.openingHoursNote }}</p>
            </div>

            <div class="info-section">
              <strong>Widoczność publiczna:</strong>
              <div class="chip" [class.active-chip]="displayedData?.openingHoursActive" 
                   [class.inactive-chip]="!displayedData?.openingHoursActive">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <ng-container *ngIf="displayedData?.openingHoursActive; else eyeOff">
                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                  </ng-container>
                  <ng-template #eyeOff>
                    <path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>
                  </ng-template>
                </svg>
                {{ displayedData?.openingHoursActive ? 'Aktywne' : 'Nieaktywne' }}
              </div>
            </div>

            <div *ngIf="!displayedData?.openingHoursInfo && !displayedData?.openingHoursNote" 
                 class="no-info">
              <p class="muted-text">Brak dodatkowych informacji</p>
            </div>
          </div>

          <!-- Edit Mode -->
          <div *ngIf="isEditMode" class="info-edit">
            <div class="form-field full-width">
              <label>Dodatkowe informacje</label>
              <textarea 
                formControlName="openingHoursInfo" 
                rows="3"
                maxlength="500"
                placeholder="np. W środy czynne od 10:00"
                class="textarea-input"></textarea>
              <div class="hint">
                {{ openingHoursForm.get('openingHoursInfo')?.value?.length || 0 }}/500
              </div>
            </div>

            <div class="form-field full-width">
              <label>Uwagi</label>
              <textarea 
                formControlName="openingHoursNote" 
                rows="3"
                maxlength="500"
                placeholder="np. W święta możliwe zmiany godzin"
                class="textarea-input"></textarea>
              <div class="hint">
                {{ openingHoursForm.get('openingHoursNote')?.value?.length || 0 }}/500
              </div>
            </div>

            <div class="visibility-toggle">
              <label class="toggle-container">
                <input type="checkbox" formControlName="openingHoursActive" class="toggle-input">
                <span class="toggle-slider"></span>
                <strong>Wyświetlaj godziny otwarcia publicznie</strong>
              </label>
              <p class="toggle-hint">
                Gdy aktywne, użytkownicy będą widzieć Twoje godziny otwarcia
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="form-actions" *ngIf="isEditMode">
        <button 
          type="button" 
          class="btn btn-secondary"
          (click)="cancelEdit()"
          [disabled]="isSaving">
          Anuluj
        </button>
        
        <button 
          type="submit"
          class="btn btn-primary"
          [disabled]="openingHoursForm.invalid || isSaving">
          <svg *ngIf="!isSaving" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
          </svg>
          <span class="spinner-small" *ngIf="isSaving"></span>
          {{ isSaving ? 'Zapisywanie...' : 'Zapisz' }}
        </button>
      </div>
    </form>

    <!-- Empty State for New Users -->
    <div *ngIf="!hasExistingHours && !isEditMode" class="empty-state">
      <svg class="empty-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"/>
      </svg>
      <h3>Brak godzin otwarcia</h3>
      <p>Uzupełnij formularz powyżej, aby dodać godziny otwarcia swojego serwisu</p>
    </div>
  </div>
</div>
<!-- src/app/pages/services-map-page/components/search-filters/search-filters.component.html -->

<div class="search-filters-container">
  <!-- Search Section -->
  <div class="search-section">
    <!-- City Search -->
    <div class="search-box">
      <label class="search-label">🏙️ Szukaj po mieście</label>
      <div class="search-input-wrapper">
        <span class="search-icon">🔍</span>
        <input 
          type="text" 
          class="search-input"
          placeholder="Wpisz nazwę miasta (min. 3 litery)..."
          [(ngModel)]="filtersState.cityQuery"
          (input)="onCitySearchChange()"
          (focus)="onCityFocus()"
        >
        <button 
          *ngIf="filtersState.cityQuery" 
          class="search-clear"
          (click)="clearCitySearch()"
          type="button"
        >
          ✕
        </button>
      </div>
      
      <div 
        class="autocomplete-dropdown" 
        *ngIf="citySearchFocused && (citySuggestions.length > 0 || citySearchLoading)"
      >
        <div class="autocomplete-loading" *ngIf="citySearchLoading">
          Szukam miast...
        </div>
        
        <div 
          class="autocomplete-item"
          *ngFor="let city of citySuggestions"
          (click)="onCitySelect(city)"
        >
          <div class="autocomplete-item-title">{{ city.name }}</div>
          <div class="autocomplete-item-subtitle">{{ city.displayName }}</div>
        </div>
      </div>
    </div>

    <!-- Service Search -->
    <div class="search-box">
      <label class="search-label">🔧 Szukaj po nazwie serwisu</label>
      <div class="search-input-wrapper">
        <span class="search-icon">🔍</span>
        <input 
          type="text" 
          class="search-input"
          placeholder="Wpisz nazwę serwisu (min. 3 litery)..."
          [(ngModel)]="filtersState.serviceQuery"
          (input)="onServiceSearchChange()"
          (focus)="onServiceFocus()"
        >
        <button 
          *ngIf="filtersState.serviceQuery" 
          class="search-clear"
          (click)="clearServiceSearch()"
          type="button"
        >
          ✕
        </button>
      </div>
      
      <div 
        class="autocomplete-dropdown" 
        *ngIf="serviceSearchFocused && (serviceSuggestions.length > 0 || serviceSearchLoading)"
      >
        <div class="autocomplete-loading" *ngIf="serviceSearchLoading">
          Szukam serwisów...
        </div>
        
        <div 
          class="autocomplete-item"
          *ngFor="let service of serviceSuggestions"
          (click)="onServiceSelect(service)"
        >
          <div class="autocomplete-item-title">
            {{ service.name }}
            <span class="autocomplete-item-badge" *ngIf="service.verified">✓ Zweryfikowany</span>
          </div>
          <div class="autocomplete-item-subtitle" *ngIf="service.address">
            📍 {{ service.address }}
          </div>
        </div>
        
        <div class="autocomplete-empty" *ngIf="!serviceSearchLoading && serviceSuggestions.length === 0 && filtersState.serviceQuery.length >= 3">
          Nie znaleziono serwisów dla "{{ filtersState.serviceQuery }}"
        </div>
      </div>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-row">
      <label class="filter-label">
        <input 
          type="checkbox" 
          class="filter-checkbox"
          [(ngModel)]="filtersState.verifiedOnly"
          (change)="onVerifiedOnlyChange()"
        >
        Tylko zweryfikowane serwisy
      </label>
      
      <button 
        class="advanced-filters-btn" 
        (click)="toggleAdvancedFilters()"
        [class.active]="showAdvancedFilters || filtersState.selectedCoverageIds.length > 0"
      >
        <span>🎯</span>
        <span>Zaawansowane filtry</span>
        <span class="filter-count" *ngIf="filtersState.selectedCoverageIds.length > 0">
          {{ filtersState.selectedCoverageIds.length }}
        </span>
      </button>
    </div>
  </div>

  <!-- Advanced Filters Panel -->
  <div class="advanced-filters-panel" *ngIf="showAdvancedFilters" [class.mobile]="isMobileView">
    <div class="filters-panel-header">
      <h3>Zaawansowane filtry</h3>
      <button class="close-filters-btn" (click)="toggleAdvancedFilters()">✕</button>
    </div>
    
    <div class="filters-panel-content">
      <div class="filter-category" *ngFor="let categoryGroup of coverageCategories">
        <h4 class="category-title">{{ categoryGroup.category.name }}</h4>
        
        <div class="coverage-list">
          <label 
            class="coverage-item" 
            *ngFor="let coverage of categoryGroup.coverages"
          >
            <input 
              type="checkbox" 
              class="coverage-checkbox"
              [checked]="isCoverageSelected(coverage.id)"
              (change)="toggleCoverage(coverage.id)"
            >
            <span class="coverage-name">{{ coverage.name }}</span>
          </label>
        </div>
      </div>
    </div>
    
    <div class="filters-panel-actions">
      <button class="filter-action-btn secondary" (click)="clearAdvancedFilters()">
        Wyczyść
      </button>
      <button class="filter-action-btn primary" (click)="applyAdvancedFilters()">
        Zastosuj ({{ filtersState.selectedCoverageIds.length }})
      </button>
    </div>
  </div>
</div>
<div class="order-details-container">
  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <button class="back-btn" (click)="goBack()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        Wróć do listy
      </button>
      <h1 *ngIf="order">Szczegóły zamówienia #{{ order.id }}</h1>
    </div>
    
    <div class="header-actions" *ngIf="order && !editMode">
      <button class="action-btn edit-btn" (click)="enableEditMode()" *ngIf="canEditOrder()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </svg>
        Edytuj
      </button>
      
      <button class="action-btn delete-btn" (click)="deleteOrder()" *ngIf="canDeleteOrder()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 6h18"></path>
          <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
          <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
        </svg>
        Usuń
      </button>
    </div>

    <div class="header-actions" *ngIf="editMode">
      <button class="action-btn save-btn" (click)="saveChanges()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        Zapisz
      </button>
      
      <button class="action-btn cancel-btn" (click)="cancelEdit()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
        Anuluj
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Ładowanie szczegółów zamówienia...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <!-- Order Details -->
  <ng-container *ngIf="!loading && !error && order">
    <!-- Status Badge -->
    <div class="status-section">
      <span class="status-badge" [ngClass]="getStatusClass(order.status)">
        {{ getStatusDisplayName(order.status) }}
      </span>
      <div class="order-dates">
        <span class="date-item">
          <strong>Data zamówienia:</strong> {{ formatDateTime(order.orderDate) }}
        </span>
        <span class="date-item" *ngIf="order.lastModifiedDate">
          <strong>Ostatnia modyfikacja:</strong> {{ formatDateTime(order.lastModifiedDate) }}
        </span>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="details-grid">
      <!-- Client Information -->
      <div class="detail-card">
        <h2>Informacje o kliencie</h2>
        <div class="detail-content" *ngIf="!editMode">
          <div class="detail-row">
            <span class="label">Imię i nazwisko:</span>
            <span class="value">{{ order.clientName || 'Brak danych' }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Email:</span>
            <span class="value">{{ order.clientEmail }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Telefon:</span>
            <span class="value">{{ order.clientPhone || 'Brak danych' }}</span>
          </div>
        </div>

        <!-- Edit Mode -->
        <div class="detail-content edit-form" *ngIf="editMode && editForm">
          <div class="form-group">
            <label>Email:</label>
            <input type="email" [(ngModel)]="editForm.email" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Telefon:</label>
            <input type="text" [(ngModel)]="editForm.phone" class="form-control" required>
          </div>
        </div>
      </div>

      <!-- Bicycle Information -->
      <div class="detail-card">
        <h2>Informacje o rowerze</h2>
        <div class="detail-content">
          <div class="detail-row">
            <span class="label">Marka:</span>
            <span class="value">{{ order.bicycleBrand || 'Nie określono' }}</span>
          </div>
          <div class="detail-row" *ngIf="order.bicycleModel">
            <span class="label">Model:</span>
            <span class="value">{{ order.bicycleModel }}</span>
          </div>
          <div class="detail-row" *ngIf="order.bicycleType">
            <span class="label">Typ:</span>
            <span class="value">{{ order.bicycleType }}</span>
          </div>
        </div>
      </div>

      <!-- Pickup Information -->
      <div class="detail-card">
        <h2>Adres odbioru</h2>
        <div class="detail-content" *ngIf="!editMode">
          <div class="detail-row">
            <span class="label">Data odbioru:</span>
            <span class="value">{{ formatDate(order.pickupDate) }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Ulica:</span>
            <span class="value">{{ order.pickupStreet }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Numer budynku:</span>
            <span class="value">{{ order.pickupBuildingNumber }}</span>
          </div>
          <div class="detail-row" *ngIf="order.pickupApartmentNumber">
            <span class="label">Numer mieszkania:</span>
            <span class="value">{{ order.pickupApartmentNumber }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Miasto:</span>
            <span class="value">{{ order.pickupCity }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Kod pocztowy:</span>
            <span class="value">{{ order.pickupPostalCode }}</span>
          </div>
          <div class="detail-row" *ngIf="order.pickupTimeWindow">
            <span class="label">Okno czasowe:</span>
            <span class="value">{{ order.pickupTimeWindow }}</span>
          </div>
        </div>

        <!-- Edit Mode -->
        <div class="detail-content edit-form" *ngIf="editMode && editForm">
          <div class="form-group">
            <label>Data odbioru:</label>
            <input type="date" [(ngModel)]="editForm.pickupDate" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Ulica:</label>
            <input type="text" [(ngModel)]="editForm.pickupStreet" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Numer budynku:</label>
            <input type="text" [(ngModel)]="editForm.pickupBuildingNumber" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Numer mieszkania:</label>
            <input type="text" [(ngModel)]="editForm.pickupApartmentNumber" class="form-control">
          </div>
          <div class="form-group">
            <label>Miasto:</label>
            <input type="text" [(ngModel)]="editForm.pickupCity" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Kod pocztowy:</label>
            <input type="text" [(ngModel)]="editForm.pickupPostalCode" class="form-control" required pattern="^\d{2}-\d{3}$" placeholder="00-000">
          </div>
        </div>
      </div>

      <!-- Delivery Information -->
      <div class="detail-card">
        <h2>Adres dostawy</h2>
        <div class="detail-content">
          <div class="detail-row">
            <span class="label">Serwis docelowy:</span>
            <span class="value">{{ order.targetServiceName || 'Brak danych' }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Adres:</span>
            <span class="value">{{ order.deliveryAddress }}</span>
          </div>
        </div>
      </div>

      <!-- Transport Information -->
      <div class="detail-card">
        <h2>Informacje o transporcie</h2>
        <div class="detail-content" *ngIf="!editMode">
          <div class="detail-row">
            <span class="label">Cena transportu:</span>
            <span class="value price">{{ formatPrice(order.transportPrice) }}</span>
          </div>
          <div class="detail-row" *ngIf="order.estimatedTime">
            <span class="label">Szacowany czas:</span>
            <span class="value">{{ order.estimatedTime }} min</span>
          </div>
          <div class="detail-row" *ngIf="order.actualPickupTime">
            <span class="label">Faktyczny czas odbioru:</span>
            <span class="value">{{ formatDateTime(order.actualPickupTime) }}</span>
          </div>
          <div class="detail-row" *ngIf="order.actualDeliveryTime">
            <span class="label">Faktyczny czas dostawy:</span>
            <span class="value">{{ formatDateTime(order.actualDeliveryTime) }}</span>
          </div>
          <div class="detail-row" *ngIf="order.actualReturnTime">
            <span class="label">Faktyczny czas zwrotu:</span>
            <span class="value">{{ formatDateTime(order.actualReturnTime) }}</span>
          </div>
        </div>

        <!-- Edit Mode -->
        <div class="detail-content edit-form" *ngIf="editMode && editForm">
          <div class="form-group">
            <label>Cena transportu (PLN):</label>
            <input type="number" step="0.01" min="0" [(ngModel)]="editForm.transportPrice" class="form-control" required>
          </div>
        </div>
      </div>

      <!-- Notes -->
      <div class="detail-card full-width" *ngIf="order.transportNotes || order.additionalNotes || editMode">
        <h2>Notatki</h2>
        <div class="detail-content" *ngIf="!editMode">
          <div class="detail-row" *ngIf="order.transportNotes">
            <span class="label">Notatki transportowe:</span>
            <span class="value">{{ order.transportNotes }}</span>
          </div>
          <div class="detail-row" *ngIf="order.additionalNotes">
            <span class="label">Dodatkowe uwagi:</span>
            <span class="value">{{ order.additionalNotes }}</span>
          </div>
        </div>

        <!-- Edit Mode -->
        <div class="detail-content edit-form" *ngIf="editMode && editForm">
          <div class="form-group">
            <label>Notatki transportowe:</label>
            <textarea [(ngModel)]="editForm.transportNotes" class="form-control" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label>Dodatkowe uwagi:</label>
            <textarea [(ngModel)]="editForm.additionalNotes" class="form-control" rows="3"></textarea>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</div>
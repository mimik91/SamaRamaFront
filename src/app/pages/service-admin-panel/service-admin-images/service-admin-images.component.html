<div class="images-container">
  <h2>Zarządzaj obrazami serwisu</h2>
  <p class="description">Zarządzaj obrazami swojego serwisu, które będą widoczne w różnych sekcjach.</p>

  <!-- Image Sections Loop -->
  <ng-container *ngFor="let type of imageTypes">
    <div class="image-section">
      <div class="section-header">
        <h3>{{ getImageTitle(type) }}</h3>
        <p class="section-description">{{ getImageDescription(type) }}</p>
      </div>

      <!-- Per-Image Error Message -->
      <div *ngIf="images[type].errorMessage" class="message error-message">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
        <span>{{ images[type].errorMessage }}</span>
      </div>

      <!-- Per-Image Success Message -->
      <div *ngIf="images[type].successMessage" class="message success-message">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        <span>{{ images[type].successMessage }}</span>
      </div>

      <!-- Loading State -->
      <div *ngIf="images[type].isLoading" class="loading-state">
        <div class="spinner"></div>
        <p>Ładowanie...</p>
      </div>

      <!-- LOGO Section (original) -->
      <ng-container *ngIf="type === 'LOGO' && !images[type].isLoading">
        <!-- Current Logo -->
        <div *ngIf="images[type].url" class="current-image-section">
          <h4>Obecne logo</h4>
          <div class="image-preview">
            <img [src]="images[type].url" [alt]="getImageTitle(type)" class="current-image">
          </div>
          <button
            (click)="deleteImage(type)"
            [disabled]="images[type].isUploading"
            class="btn btn-danger">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
            Usuń logo
          </button>
        </div>

        <!-- No Logo State -->
        <div *ngIf="!images[type].url && !images[type].selectedFile" class="no-image-state">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <circle cx="8.5" cy="8.5" r="1.5"></circle>
            <polyline points="21 15 16 10 5 21"></polyline>
          </svg>
          <p>Nie masz jeszcze logo</p>
        </div>

        <!-- Upload Section -->
        <div class="upload-section">
          <h4>{{ images[type].url ? 'Zmień logo' : 'Dodaj logo' }}</h4>

          <div class="upload-requirements">
            <p><strong>Wymagania:</strong></p>
            <ul>
              <li>Format: JPG, PNG, WEBP lub GIF</li>
              <li>Maksymalny rozmiar: 1 MB</li>
              <li>Zalecane proporcje: kwadratowe (1:1)</li>
            </ul>
          </div>

          <div class="file-input-wrapper">
            <input
              [id]="type.toLowerCase() + '-upload'"
              [attr.data-image-type]="type"
              #fileInputRef
              type="file"
              accept="image/*"
              (change)="onFileSelected($event, type)"
              [disabled]="images[type].isUploading"
              class="file-input">
            <label [for]="type.toLowerCase() + '-upload'" class="file-input-label" [class.disabled]="images[type].isUploading">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              {{ images[type].isUploading ? 'Przesyłanie...' : 'Wybierz plik' }}
            </label>
          </div>

          <!-- Selected File Preview -->
          <div *ngIf="images[type].selectedFile" class="selected-preview">
            <div class="preview-image-wrapper">
              <img [src]="images[type].previewUrl" alt="Podgląd" class="preview-image">
            </div>
            <div class="file-details">
              <p class="file-name">{{ images[type].selectedFile!.name }}</p>
              <p class="file-size">{{ formatFileSize(images[type].selectedFile!.size) }}</p>
            </div>
            <div class="upload-actions">
              <button
                (click)="uploadCustomImage(type)"
                [disabled]="images[type].isUploading"
                class="btn btn-primary">
                <svg *ngIf="!images[type].isUploading" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="7 10 12 15 17 10"></polyline>
                  <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                {{ images[type].isUploading ? 'Przesyłanie...' : 'Prześlij logo' }}
              </button>
              <button
                (click)="clearSelection(type)"
                [disabled]="images[type].isUploading"
                class="btn btn-secondary">
                Anuluj
              </button>
            </div>

            <!-- Upload Progress -->
            <div *ngIf="images[type].isUploading" class="progress-bar-wrapper">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="images[type].uploadProgress"></div>
              </div>
              <p class="progress-text">{{ images[type].uploadProgress }}%</p>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- CAROUSEL Section (ABOUT_US & OPENING_HOURS) -->
      <ng-container *ngIf="canShowCarousel(type) && !images[type].isLoading">
        <div class="carousel-section">
          <!-- Current Image Display with Delete -->
          <div *ngIf="images[type].url" class="current-selection">
            <div class="current-badge">Aktualnie wybrany obraz</div>
            <button
              (click)="deleteImage(type)"
              [disabled]="images[type].isUploading"
              class="btn btn-danger btn-sm delete-current">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
              Usuń
            </button>
          </div>

          <!-- Carousel -->
          <div class="carousel-container">
            <button
              class="carousel-nav carousel-nav-left"
              (click)="navigateCarousel(type, 'prev')"
              [disabled]="images[type].isUploading">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>

            <div class="carousel-images">
              <!-- Previous Image -->
              <div class="carousel-item carousel-item-side">
                <img [src]="getPrevImageUrl(type)" alt="Poprzedni">
              </div>

              <!-- Current Image (main) -->
              <div class="carousel-item carousel-item-main">
                <img [src]="getCurrentImageUrl(type)" alt="Aktualny">
              </div>

              <!-- Next Image -->
              <div class="carousel-item carousel-item-side">
                <img [src]="getNextImageUrl(type)" alt="Następny">
              </div>
            </div>

            <button
              class="carousel-nav carousel-nav-right"
              (click)="navigateCarousel(type, 'next')"
              [disabled]="images[type].isUploading">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
          </div>

          <!-- Action Buttons -->
          <div class="carousel-actions">
            <button
              (click)="selectCurrentImage(type)"
              [disabled]="images[type].isUploading"
              class="btn btn-primary">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              Wybierz to zdjęcie
            </button>

            <div class="or-divider">lub</div>

            <!-- Upload New Image -->
            <div class="upload-new-section">
              <input
                [id]="type.toLowerCase() + '-upload'"
                [attr.data-image-type]="type"
                #fileInputRef
                type="file"
                accept="image/*"
                (change)="onFileSelected($event, type)"
                [disabled]="images[type].isUploading"
                class="file-input">
              <label [for]="type.toLowerCase() + '-upload'" class="file-input-label" [class.disabled]="images[type].isUploading">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="17 8 12 3 7 8"></polyline>
                  <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                Załaduj nowe zdjęcie
              </label>
            </div>
          </div>

          <!-- Custom Image Upload Preview -->
          <div *ngIf="images[type].selectedFile" class="selected-preview">
            <div class="preview-image-wrapper">
              <img [src]="images[type].previewUrl" alt="Podgląd" class="preview-image">
            </div>
            <div class="file-details">
              <p class="file-name">{{ images[type].selectedFile!.name }}</p>
              <p class="file-size">{{ formatFileSize(images[type].selectedFile!.size) }}</p>
            </div>
            <div class="upload-actions">
              <button
                (click)="uploadCustomImage(type)"
                [disabled]="images[type].isUploading"
                class="btn btn-primary">
                <svg *ngIf="!images[type].isUploading" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="7 10 12 15 17 10"></polyline>
                  <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                {{ images[type].isUploading ? 'Przesyłanie...' : 'Prześlij obraz' }}
              </button>
              <button
                (click)="clearSelection(type)"
                [disabled]="images[type].isUploading"
                class="btn btn-secondary">
                Anuluj
              </button>
            </div>

            <!-- Upload Progress -->
            <div *ngIf="images[type].isUploading" class="progress-bar-wrapper">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="images[type].uploadProgress"></div>
              </div>
              <p class="progress-text">{{ images[type].uploadProgress }}%</p>
            </div>
          </div>

          <!-- Requirements Info -->
          <div class="upload-requirements">
            <p><strong>Wymagania:</strong></p>
            <ul>
              <li>Format: JPG, PNG, WEBP lub GIF</li>
              <li>Maksymalny rozmiar: 1 MB</li>
              <li>Zalecane proporcje: pionowe (9:16)</li>
            </ul>
          </div>
        </div>
      </ng-container>
    </div>
  </ng-container>
</div>